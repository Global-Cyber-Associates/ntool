const a40_0x911dab=a40_0x5320;(function(_0x214c47,_0x6556a5){const _0x37cf2e=a40_0x5320,_0x5e6503=_0x214c47();while(!![]){try{const _0x6c7adc=parseInt(_0x37cf2e(0xa2))/0x1*(parseInt(_0x37cf2e(0x89))/0x2)+-parseInt(_0x37cf2e(0x71))/0x3+parseInt(_0x37cf2e(0x9b))/0x4*(-parseInt(_0x37cf2e(0x99))/0x5)+-parseInt(_0x37cf2e(0x93))/0x6*(-parseInt(_0x37cf2e(0x79))/0x7)+-parseInt(_0x37cf2e(0x88))/0x8+parseInt(_0x37cf2e(0xa1))/0x9+-parseInt(_0x37cf2e(0x91))/0xa*(-parseInt(_0x37cf2e(0x7e))/0xb);if(_0x6c7adc===_0x6556a5)break;else _0x5e6503['push'](_0x5e6503['shift']());}catch(_0x5bdfff){_0x5e6503['push'](_0x5e6503['shift']());}}}(a40_0x46f2,0xd91d2));import{spawn}from'child_process';import a40_0x144f2e from'path';import{fileURLToPath}from'url';function a40_0x46f2(){const _0x1cf175=['1660mmZTuR','âš ï¸\x20Waiting\x20for\x20valid\x20MongoDB\x20Setup...','3289398sjAsVR','error','join','startsWith','exit','parse','925XHWgWR','mongo_uri','13212EHqbEM','log','dirname','stdout','endsWith','url','1489068owVVlB','11HPeQZs','utf8','âœ…\x20MongoDB\x20URI\x20detected:','connect','toLocaleTimeString','ðŸ”\x20Scanner\x20cycle\x20finished\x20with\x20code\x20','ðŸ“¡\x20Received\x20','3832101TjfqiI','ðŸ”¥\x20Python\x20error:','setEncoding','deleteMany','pipe','toString','./visualizer.js','slice','14rluEgm','trim','python','\x20devices\x20from\x20Python','length','134629OTdQni','stderr','mongodb+srv://','message','ips','âœ…\x20Visualizer\x20update\x20completed.','\x20devices\x20to\x20DB','then','ignore','data','11695152GZEkwf','172004YMDBFc','âŒ\x20MongoDB\x20connection\x20failed:','findOneAndUpdate','close','âŒ\x20JSON\x20parse\x20error:','â³\x20Waiting\x205\x20seconds\x20before\x20next\x20scan...','../config.json','âœ…\x20Synced\x20'];a40_0x46f2=function(){return _0x1cf175;};return a40_0x46f2();}import a40_0x3146dd from'mongoose';import a40_0x10e4c5 from'fs';import a40_0x58be90 from'../models/VisualizerScanner.js';const __filename=fileURLToPath(import.meta[a40_0x911dab(0xa0)]),__dirname=a40_0x144f2e[a40_0x911dab(0x9d)](__filename),scannerPath=a40_0x144f2e['join'](__dirname,'scanner_service.py'),configPath=a40_0x144f2e[a40_0x911dab(0x95)](__dirname,a40_0x911dab(0x8f));function getMongoURI(){const _0x529b9=a40_0x911dab;try{const _0x49e002=JSON[_0x529b9(0x98)](a40_0x10e4c5['readFileSync'](configPath,_0x529b9(0xa3)));return _0x49e002[_0x529b9(0x9a)]||'';}catch{return'';}}async function waitForMongoURI(){const _0x83aec1=a40_0x911dab;let _0x329281=getMongoURI();while(!_0x329281[_0x83aec1(0x96)]('mongodb://')&&!_0x329281['startsWith'](_0x83aec1(0x80))){console[_0x83aec1(0x9c)](_0x83aec1(0x92)),await new Promise(_0x398aa7=>setTimeout(_0x398aa7,0xbb8)),_0x329281=getMongoURI();}return console[_0x83aec1(0x9c)](_0x83aec1(0x6c),_0x329281),_0x329281;}function a40_0x5320(_0x473b37,_0x4909fc){const _0x46f2f=a40_0x46f2();return a40_0x5320=function(_0x532065,_0x48eed7){_0x532065=_0x532065-0x6c;let _0x1e902d=_0x46f2f[_0x532065];return _0x1e902d;},a40_0x5320(_0x473b37,_0x4909fc);}async function connectMongo(){const _0x463dac=a40_0x911dab,_0x486d46=await waitForMongoURI();await a40_0x3146dd[_0x463dac(0x6d)](_0x486d46)[_0x463dac(0x85)](()=>console[_0x463dac(0x9c)]('âœ…\x20Connected\x20to\x20MongoDB\x20(scanner)'))['catch'](_0x2d48e5=>{const _0x36aed3=_0x463dac;console[_0x36aed3(0x94)](_0x36aed3(0x8a),_0x2d48e5[_0x36aed3(0x81)]),process[_0x36aed3(0x97)](0x1);});}async function runScannerCycle(){const _0x390bcc=a40_0x911dab;return console[_0x390bcc(0x9c)]('ðŸš€\x20Starting\x20Python\x20scanner\x20cycle...'),new Promise(_0x667947=>{const _0xda5a04=_0x390bcc,_0x5f4885=spawn(_0xda5a04(0x7b),[scannerPath],{'cwd':__dirname,'stdio':[_0xda5a04(0x86),_0xda5a04(0x75),_0xda5a04(0x75)]});let _0x4d0430='';_0x5f4885[_0xda5a04(0x9e)][_0xda5a04(0x73)]('utf8'),_0x5f4885[_0xda5a04(0x9e)]['on'](_0xda5a04(0x87),async _0x17c584=>{const _0x467e2c=_0xda5a04;_0x4d0430+=_0x17c584[_0x467e2c(0x76)]();if(_0x4d0430[_0x467e2c(0x7a)]()[_0x467e2c(0x9f)](']'))try{const _0x1d4968=_0x4d0430['indexOf']('['),_0x26ae31=_0x4d0430[_0x467e2c(0x78)](_0x1d4968)['trim'](),_0x4794df=JSON['parse'](_0x26ae31);console[_0x467e2c(0x9c)](_0x467e2c(0x70)+_0x4794df[_0x467e2c(0x7d)]+_0x467e2c(0x7c));const _0x25c0d4=_0x4794df['map'](_0x22b4b0=>_0x22b4b0[_0x467e2c(0x82)][0x0]);await a40_0x58be90[_0x467e2c(0x74)]({'ips.0':{'$nin':_0x25c0d4}});for(const _0x4b29ef of _0x4794df){await a40_0x58be90[_0x467e2c(0x8b)]({'ips.0':_0x4b29ef[_0x467e2c(0x82)][0x0]},{..._0x4b29ef,'lastSeen':new Date()},{'upsert':!![],'new':!![]});}console[_0x467e2c(0x9c)](_0x467e2c(0x90)+_0x4794df['length']+_0x467e2c(0x84)),console['log']('âš™ï¸\x20Running\x20visualizer\x20update\x20after\x20scan...');try{const {runVisualizerUpdate:_0x3ce7c2}=await import(_0x467e2c(0x77));await _0x3ce7c2(),console[_0x467e2c(0x9c)](_0x467e2c(0x83));}catch(_0x52ac9b){console[_0x467e2c(0x94)]('âŒ\x20Visualizer\x20update\x20failed:',_0x52ac9b[_0x467e2c(0x81)]);}_0x4d0430='';}catch(_0x39e169){console[_0x467e2c(0x94)](_0x467e2c(0x8d),_0x39e169[_0x467e2c(0x81)]),_0x4d0430='';}}),_0x5f4885[_0xda5a04(0x7f)]['on'](_0xda5a04(0x87),_0x56c232=>{const _0x183f19=_0xda5a04;console[_0x183f19(0x94)](_0x183f19(0x72),_0x56c232[_0x183f19(0x76)]());}),_0x5f4885['on'](_0xda5a04(0x8c),_0x59a298=>{const _0x4ae358=_0xda5a04;console['log'](_0x4ae358(0x6f)+_0x59a298),_0x667947();});});}async function startContinuousLoop(){const _0x548217=a40_0x911dab;await connectMongo();while(!![]){console[_0x548217(0x9c)]('\x0aðŸŒ€\x20New\x20scan\x20cycle\x20started\x20at\x20'+new Date()[_0x548217(0x6e)]()),await runScannerCycle(),console[_0x548217(0x9c)](_0x548217(0x8e)),await new Promise(_0x4c2105=>setTimeout(_0x4c2105,0x1388));}}startContinuousLoop();