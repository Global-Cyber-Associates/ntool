function a34_0xba3f(_0xb4d859,_0x19855a){const _0x482c9b=a34_0x482c();return a34_0xba3f=function(_0xba3f90,_0x368c61){_0xba3f90=_0xba3f90-0xd4;let _0x46617a=_0x482c9b[_0xba3f90];return _0x46617a;},a34_0xba3f(_0xb4d859,_0x19855a);}const a34_0x163f53=a34_0xba3f;(function(_0x25f64d,_0x3f8f62){const _0x1eb420=a34_0xba3f,_0x362295=_0x25f64d();while(!![]){try{const _0x50c101=-parseInt(_0x1eb420(0x112))/0x1+parseInt(_0x1eb420(0xf9))/0x2+-parseInt(_0x1eb420(0x101))/0x3+parseInt(_0x1eb420(0xde))/0x4+parseInt(_0x1eb420(0xf2))/0x5+parseInt(_0x1eb420(0xfc))/0x6*(-parseInt(_0x1eb420(0x118))/0x7)+-parseInt(_0x1eb420(0xd5))/0x8*(parseInt(_0x1eb420(0x106))/0x9);if(_0x50c101===_0x3f8f62)break;else _0x362295['push'](_0x362295['shift']());}catch(_0x4307dc){_0x362295['push'](_0x362295['shift']());}}}(a34_0x482c,0x2b502));import a34_0x5625d2 from'express';import a34_0x16fc34 from'http';import a34_0xabb7a6 from'cors';import a34_0x199a93 from'fs';import a34_0x4dd0ab from'path';import{Server}from'socket.io';import{connectMongo}from'./db.js';import{saveAgentData}from'./save.js';import*as a34_0xfecfd4 from'./get.js';import{checkUsbStatus}from'./controllers/usbhandler.js';import a34_0x4f52e8 from'./api/usb.js';import a34_0x3085c2 from'./api/visualizerData.js';import a34_0x1f30ab from'./api/system.js';import{getLogsSnapshot}from'./controllers/logsController.js';import a34_0x13eb46 from'./api/logs.js';import a34_0x259b62 from'./api/scanRun.js';import{isRouterIP}from'./utils/networkHelpers.js';import a34_0x53267f from'./models/Log.js';function a34_0x482c(){const _0x598735=['âŒ\x20logs\x20broadcast\x20error:','resolve','agentId','[ðŸ§ ]\x20Logs\x20snapshot\x20updated\x20&\x20broadcast:','90173pOVATQ','findOneAndUpdate','existsSync','error','toISOString','disconnect','84bMTjYt','listen','readFileSync','âŒ\x20Error\x20handling\x20agent\x20data:','8MMshMy','Failed\x20to\x20save\x20agent\x20data','ðŸ’¥\x20Failed\x20to\x20start\x20server:','agent_response','/api/logs-status','log','json','connection','split','1154872beEGrW','type','parse','0.0.0.0','/api/scan','Failed\x20to\x20fetch\x20data','writeFileSync','vendor','/api','cors_origin','unknown','slice','Invalid\x20payload\x20format','message','utf-8','cwd','x-forwarded-for','[ðŸ“¦]\x20Received\x20','push','createServer','1507520oagaKy','/health','fetchData','handshake','ðŸ”Œ\x20Agent\x20connected:\x20','hostname','use','258458euzQYB','usb_validation','âŒ\x20Failed\x20to\x20log\x20agent\x20data:','13584PoWQnX','/api/usb','POST','logs_status_update','join','552438QKkJwO','usb_devices','/api/visualizer-data','socket_port','data','2164986HnUUuB','emit','utf8','âš ï¸\x20Agent\x20disconnected:\x20','get_data','unknownDevices','address','connected_devices'];a34_0x482c=function(){return _0x598735;};return a34_0x482c();}import'./visualizer-script/visualizerScanner.js';const configPath=a34_0x4dd0ab[a34_0x163f53(0x10f)]('./config.json'),config=JSON[a34_0x163f53(0xe0)](a34_0x199a93[a34_0x163f53(0x11a)](configPath,a34_0x163f53(0x108))),app=a34_0x5625d2();app['use'](a34_0xabb7a6({'origin':config[a34_0x163f53(0xe7)]||'*'})),app[a34_0x163f53(0xf8)](a34_0x5625d2[a34_0x163f53(0xdb)]()),app[a34_0x163f53(0xf8)](a34_0x163f53(0x103),a34_0x3085c2),app[a34_0x163f53(0xf8)](a34_0x163f53(0xe6),a34_0x1f30ab),app[a34_0x163f53(0xf8)](a34_0x163f53(0xd9),a34_0x13eb46),app['use'](a34_0x163f53(0xfd),a34_0x4f52e8),app[a34_0x163f53(0xf8)](a34_0x163f53(0xe2),a34_0x259b62),app['get'](a34_0x163f53(0xf3),(_0x3c74d7,_0x2b5fda)=>_0x2b5fda[a34_0x163f53(0xdb)]({'status':'ok','ts':new Date()[a34_0x163f53(0x116)]()}));const server=a34_0x16fc34[a34_0x163f53(0xf1)](app),io=new Server(server,{'cors':{'origin':config[a34_0x163f53(0xe7)]||'*','methods':['GET',a34_0x163f53(0xfe)]},'pingTimeout':0x4e20,'pingInterval':0x1388}),logPath=a34_0x4dd0ab[a34_0x163f53(0x100)](process[a34_0x163f53(0xed)](),'agent_data_log.json');setInterval(async()=>{const _0x120587=a34_0x163f53;try{let _0x5b27dc=await getLogsSnapshot();_0x5b27dc[_0x120587(0x10b)]=_0x5b27dc['unknownDevices']['filter'](_0x223eb8=>!isRouterIP(_0x223eb8['ip'],_0x223eb8[_0x120587(0xf7)],_0x223eb8[_0x120587(0xe5)])),await a34_0x53267f[_0x120587(0x113)]({},{'$set':_0x5b27dc},{'upsert':!![],'new':!![]}),io[_0x120587(0x107)](_0x120587(0xff),_0x5b27dc),console[_0x120587(0xda)](_0x120587(0x111),new Date()['toISOString']());}catch(_0x1e7cb3){console[_0x120587(0x115)](_0x120587(0x10e),_0x1e7cb3);}},0x1388),io['on'](a34_0x163f53(0xdc),_0x3e5837=>{const _0x3d5b95=a34_0x163f53,_0x4fea27=_0x3e5837[_0x3d5b95(0xf5)]['headers'][_0x3d5b95(0xee)]?.[_0x3d5b95(0xdd)](',')[0x0]||_0x3e5837['handshake'][_0x3d5b95(0x10c)]||_0x3d5b95(0xe8);console[_0x3d5b95(0xda)](_0x3d5b95(0xf6)+_0x3e5837['id']+'\x20('+_0x4fea27+')'),_0x3e5837['on']('agent_data',async _0x750d0=>{const _0x3c7fb3=_0x3d5b95;try{if(!_0x750d0?.[_0x3c7fb3(0xdf)]||!_0x750d0?.['data']||!_0x750d0?.[_0x3c7fb3(0x110)]){_0x3e5837[_0x3c7fb3(0x107)](_0x3c7fb3(0xd8),{'success':![],'message':_0x3c7fb3(0xea)});return;}_0x750d0['ip']=_0x4fea27;try{const _0x21fedc=a34_0x199a93[_0x3c7fb3(0x114)](logPath)?JSON[_0x3c7fb3(0xe0)](a34_0x199a93[_0x3c7fb3(0x11a)](logPath,_0x3c7fb3(0xec))):[];_0x21fedc[_0x3c7fb3(0xf0)]({'timestamp':new Date()[_0x3c7fb3(0x116)](),'payload':_0x750d0}),a34_0x199a93[_0x3c7fb3(0xe4)](logPath,JSON['stringify'](_0x21fedc[_0x3c7fb3(0xe9)](-0xc8),null,0x2),'utf-8');}catch(_0x244310){console[_0x3c7fb3(0x115)](_0x3c7fb3(0xfb),_0x244310);}console['log'](_0x3c7fb3(0xef)+_0x750d0['type']+'\x20from\x20agent\x20'+_0x750d0[_0x3c7fb3(0x110)]+'\x20('+_0x4fea27+')');if(_0x750d0['type']===_0x3c7fb3(0x102)){const _0x2da8a4=_0x750d0[_0x3c7fb3(0x105)][_0x3c7fb3(0x10d)]||[];console['log']('[ðŸ”¹]\x20Connected\x20devices\x20received:',_0x2da8a4);const _0x36b398=await checkUsbStatus(_0x750d0['agentId'],_0x2da8a4);_0x3e5837['emit'](_0x3c7fb3(0xfa),{'devices':_0x36b398}),console[_0x3c7fb3(0xda)]('[âœ…]\x20USB\x20statuses\x20sent\x20to\x20agent:',_0x36b398);return;}await saveAgentData(_0x750d0),_0x3e5837[_0x3c7fb3(0x107)]('agent_response',{'success':!![],'message':_0x750d0['type']+'\x20saved\x20successfully'});}catch(_0x1f45e6){console[_0x3c7fb3(0x115)](_0x3c7fb3(0xd4),_0x1f45e6),_0x3e5837['emit'](_0x3c7fb3(0xd8),{'success':![],'message':_0x3c7fb3(0xd6),'error':_0x1f45e6[_0x3c7fb3(0xeb)]});}}),_0x3e5837['on'](_0x3d5b95(0x10a),async(_0x2fa7b0,_0x4f5ca1)=>{const _0x1b6b9b=_0x3d5b95;try{const _0xbbfa09=await a34_0xfecfd4[_0x1b6b9b(0xf4)](_0x2fa7b0);_0x4f5ca1(_0xbbfa09);}catch(_0x4fd620){console['error']('âŒ\x20Error\x20fetching\x20data:',_0x4fd620),_0x4f5ca1({'success':![],'message':_0x1b6b9b(0xe3),'error':_0x4fd620[_0x1b6b9b(0xeb)],'data':[]});}}),_0x3e5837['on'](_0x3d5b95(0x117),_0x11e608=>{const _0x473d31=_0x3d5b95;console[_0x473d31(0xda)](_0x473d31(0x109)+_0x3e5837['id']+'\x20('+_0x11e608+')');});});async function start(){const _0x3fc5fc=a34_0x163f53;try{await connectMongo(config['mongo_uri']),console[_0x3fc5fc(0xda)]('âœ…\x20MongoDB\x20connected'),server[_0x3fc5fc(0x119)](config[_0x3fc5fc(0x104)]||0x1388,_0x3fc5fc(0xe1),()=>{const _0x3d16e6=_0x3fc5fc;console[_0x3d16e6(0xda)]('ðŸš€\x20Socket\x20server\x20running\x20on\x20port\x20'+(config[_0x3d16e6(0x104)]||0x1388));});}catch(_0x4a2cc2){console[_0x3fc5fc(0x115)](_0x3fc5fc(0xd7),_0x4a2cc2),process['exit'](0x1);}}start();