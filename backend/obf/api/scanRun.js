const a10_0x5a205b=a10_0x24cb;(function(_0x57ef94,_0x255667){const _0x3597a6=a10_0x24cb,_0x46d9fb=_0x57ef94();while(!![]){try{const _0x123d52=parseInt(_0x3597a6(0x144))/0x1*(-parseInt(_0x3597a6(0x130))/0x2)+parseInt(_0x3597a6(0x155))/0x3+-parseInt(_0x3597a6(0x14f))/0x4+-parseInt(_0x3597a6(0x146))/0x5+parseInt(_0x3597a6(0x15d))/0x6+parseInt(_0x3597a6(0x158))/0x7+parseInt(_0x3597a6(0x12e))/0x8;if(_0x123d52===_0x255667)break;else _0x46d9fb['push'](_0x46d9fb['shift']());}catch(_0x245c15){_0x46d9fb['push'](_0x46d9fb['shift']());}}}(a10_0x4f77,0x6c528));import a10_0xc5879e from'express';import{execFile}from'child_process';import a10_0x3b64c9 from'path';import{fileURLToPath}from'url';function a10_0x24cb(_0x39495d,_0x156027){const _0x4f775d=a10_0x4f77();return a10_0x24cb=function(_0x24cb4d,_0x16ae6a){_0x24cb4d=_0x24cb4d-0x12a;let _0xa1003e=_0x4f775d[_0x24cb4d];return _0xa1003e;},a10_0x24cb(_0x39495d,_0x156027);}function a10_0x4f77(){const _0x5917b7=['Medium','toString','10615832vxOdhi','status','36RgNQUm','Scanner\x20returned\x20unexpected\x20payload','Critical','Raw\x20stdout:','dirname','findOne','local-scanner','\x20overall=','Internal\x20server\x20error','_id','get','duration_seconds','hosts','impact','[api/scan]\x20Failed\x20to\x20fetch\x20latest\x20scan:','indexOf','object','Low','Scanner\x20produced\x20no\x20output','High','40811mjjRRS','stderr','3504400BxkxBR','[api/scan]\x20Scanner\x20produced\x20no\x20stdout.\x20Stderr:','[scanner\x20stderr]','length','toISOString','join','error','[api/scan]\x20Failed\x20to\x20parse\x20scanner\x20JSON:','message','3322764YZVFLN','No\x20previous\x20scan\x20found','/latest','trim','isArray','Router','1359048wjtatZ','json','[api/scan]\x20Triggered\x20network\x20scan','3685892aTLiPX','../scanner/network_scanner_cli.py','unknown','python','[api/scan]\x20Error\x20while\x20saving/parsing\x20scanner\x20output:','2419836pyilmg','parse','[api/scan]\x20Scan\x20saved.\x20hosts=','url','impact_level','[api/scan]\x20Scanner\x20process\x20error:','Stderr:','log','data','Info'];a10_0x4f77=function(){return _0x5917b7;};return a10_0x4f77();}import a10_0x3d70de from'../models/ScanResult.js';const router=a10_0xc5879e[a10_0x5a205b(0x154)](),__filename=fileURLToPath(import.meta[a10_0x5a205b(0x160)]),__dirname=a10_0x3b64c9[a10_0x5a205b(0x134)](__filename),scannerScript=a10_0x3b64c9[a10_0x5a205b(0x14b)](__dirname,a10_0x5a205b(0x159));function computeOverallImpact(_0x30d63f=[]){const _0x174f2b=a10_0x5a205b,_0xb9eb26=[_0x174f2b(0x12b),_0x174f2b(0x141),_0x174f2b(0x12c),_0x174f2b(0x143),_0x174f2b(0x132)];let _0x52cccc=_0x174f2b(0x12b);for(const _0x33d709 of _0x30d63f){const _0x2e686d=_0x33d709?.[_0x174f2b(0x161)]||_0x33d709?.[_0x174f2b(0x13d)]||_0x174f2b(0x12b);_0xb9eb26[_0x174f2b(0x13f)](_0x2e686d)>_0xb9eb26[_0x174f2b(0x13f)](_0x52cccc)&&(_0x52cccc=_0x2e686d);}return _0x52cccc;}router['post']('/',async(_0x46097d,_0x5a953f)=>{const _0x3e5e99=a10_0x5a205b;console[_0x3e5e99(0x164)](_0x3e5e99(0x157));const _0x1ed217=execFile(_0x3e5e99(0x15b),[scannerScript],{'timeout':0x3*0x3c*0x3e8,'maxBuffer':0x14*0x400*0x400},async(_0x321a3d,_0x21a92e,_0x405e0c)=>{const _0x5aa97f=_0x3e5e99;if(_0x321a3d)return console[_0x5aa97f(0x14c)](_0x5aa97f(0x162),_0x321a3d),_0x5a953f['status'](0x1f4)[_0x5aa97f(0x156)]({'ok':![],'error':_0x321a3d[_0x5aa97f(0x14e)],'stderr':(_0x405e0c||'')[_0x5aa97f(0x12d)]()});try{const _0x26fea5=(_0x21a92e||'')['toString']()[_0x5aa97f(0x152)]();if(!_0x26fea5)return console[_0x5aa97f(0x14c)](_0x5aa97f(0x147),(_0x405e0c||'')[_0x5aa97f(0x12d)]()),_0x5a953f[_0x5aa97f(0x12f)](0x1f4)[_0x5aa97f(0x156)]({'ok':![],'error':_0x5aa97f(0x142),'stderr':(_0x405e0c||'')[_0x5aa97f(0x12d)]()});let _0x472f69;try{_0x472f69=JSON[_0x5aa97f(0x15e)](_0x26fea5);}catch(_0x880266){return console[_0x5aa97f(0x14c)](_0x5aa97f(0x14d),_0x880266),console[_0x5aa97f(0x14c)](_0x5aa97f(0x133),_0x26fea5),console[_0x5aa97f(0x14c)](_0x5aa97f(0x163),(_0x405e0c||'')[_0x5aa97f(0x12d)]()),_0x5a953f[_0x5aa97f(0x12f)](0x1f4)[_0x5aa97f(0x156)]({'ok':![],'error':'Invalid\x20JSON\x20from\x20scanner','detail':_0x880266['message'],'raw':_0x26fea5});}if(!_0x472f69||typeof _0x472f69!==_0x5aa97f(0x140))return _0x5a953f[_0x5aa97f(0x12f)](0x1f4)['json']({'ok':![],'error':_0x5aa97f(0x131)});const _0x17139b=Array[_0x5aa97f(0x153)](_0x472f69[_0x5aa97f(0x13c)])?_0x472f69[_0x5aa97f(0x13c)]:[],_0x232d10=computeOverallImpact(_0x17139b),_0x1542e8=await a10_0x3d70de['findOneAndUpdate']({},{'$set':{'ok':_0x472f69['ok']!==undefined?_0x472f69['ok']:!![],'network':_0x472f69['network']||_0x5aa97f(0x15a),'scanned_at':_0x472f69['scanned_at']||new Date()[_0x5aa97f(0x14a)](),'duration_seconds':_0x472f69[_0x5aa97f(0x13b)]||0x0,'hosts':_0x17139b,'overall_impact':_0x232d10,'raw':_0x472f69,'source':_0x5aa97f(0x136),'updated_at':new Date()}},{'upsert':!![],'new':!![]});return console[_0x5aa97f(0x164)](_0x5aa97f(0x15f)+_0x17139b[_0x5aa97f(0x149)]+_0x5aa97f(0x137)+_0x232d10),_0x5a953f[_0x5aa97f(0x156)]({'ok':!![],'saved':!![],'id':_0x1542e8[_0x5aa97f(0x139)],'result':_0x472f69,'overall_impact':_0x232d10});}catch(_0x4e3d90){return console[_0x5aa97f(0x14c)](_0x5aa97f(0x15c),_0x4e3d90),_0x5a953f[_0x5aa97f(0x12f)](0x1f4)[_0x5aa97f(0x156)]({'ok':![],'error':_0x5aa97f(0x138),'detail':_0x4e3d90[_0x5aa97f(0x14e)]});}});_0x1ed217[_0x3e5e99(0x145)]?.['on'](_0x3e5e99(0x12a),_0x465c88=>{const _0x433087=_0x3e5e99;console['error'](_0x433087(0x148),_0x465c88[_0x433087(0x12d)]());});}),router[a10_0x5a205b(0x13a)](a10_0x5a205b(0x151),async(_0x20cec9,_0x3c218f)=>{const _0x46cad3=a10_0x5a205b;try{const _0x462664=await a10_0x3d70de[_0x46cad3(0x135)]({},{},{'sort':{'updated_at':-0x1}});if(!_0x462664)return _0x3c218f[_0x46cad3(0x12f)](0x194)[_0x46cad3(0x156)]({'ok':![],'message':_0x46cad3(0x150)});return _0x3c218f[_0x46cad3(0x156)](_0x462664);}catch(_0x3fda20){return console[_0x46cad3(0x14c)](_0x46cad3(0x13e),_0x3fda20),_0x3c218f[_0x46cad3(0x12f)](0x1f4)[_0x46cad3(0x156)]({'ok':![],'error':_0x3fda20['message']});}});export default router;