const a2_0x48b673=a2_0x3eb1;(function(_0x525275,_0x580640){const _0xa88d59=a2_0x3eb1,_0x327da2=_0x525275();while(!![]){try{const _0x12085b=-parseInt(_0xa88d59(0x11f))/0x1*(parseInt(_0xa88d59(0x107))/0x2)+parseInt(_0xa88d59(0x116))/0x3+parseInt(_0xa88d59(0x118))/0x4+parseInt(_0xa88d59(0x121))/0x5*(-parseInt(_0xa88d59(0x120))/0x6)+parseInt(_0xa88d59(0x11b))/0x7+-parseInt(_0xa88d59(0x10b))/0x8+-parseInt(_0xa88d59(0x104))/0x9*(-parseInt(_0xa88d59(0x113))/0xa);if(_0x12085b===_0x580640)break;else _0x327da2['push'](_0x327da2['shift']());}catch(_0x46e777){_0x327da2['push'](_0x327da2['shift']());}}}(a2_0x229b,0x18d61));import a2_0x20e63c from'express';import a2_0x12a5e7 from'bcrypt';import a2_0x49ad9b from'jsonwebtoken';import a2_0x1d6e15 from'dotenv';import a2_0x3af5d8 from'../models/User.js';a2_0x1d6e15[a2_0x48b673(0x109)]();const router=a2_0x20e63c[a2_0x48b673(0x105)](),JWT_SECRET=process['env']['JWT_SECRET'];if(!JWT_SECRET)throw new Error('JWT_SECRET\x20is\x20not\x20defined\x20in\x20.env');function a2_0x229b(){const _0x1ff7ab=['json','1072974wwYOPM','findOne','_id','save','22679KGXHPO','20862HCgkzC','170yowmJC','username','Internal\x20Server\x20Error','password','901377jEvXGw','Router','USER_REGISTERED','10SuryBD','body','config','Invalid\x20password\x20for\x20user:\x20','1343616MsXscY','error','status','FAILED_LOGIN','Invalid\x20credentials','compare','/register','New\x20user\x20registered:\x20','10oLYGlS','hash','User\x20already\x20exists','188280cZZxfp','User\x20registered\x20successfully','740396vJCgmA','sign'];a2_0x229b=function(){return _0x1ff7ab;};return a2_0x229b();}function a2_0x3eb1(_0x539cdd,_0x1a7707){const _0x229b4d=a2_0x229b();return a2_0x3eb1=function(_0x3eb198,_0x5c19bd){_0x3eb198=_0x3eb198-0x102;let _0x5ba1a4=_0x229b4d[_0x3eb198];return _0x5ba1a4;},a2_0x3eb1(_0x539cdd,_0x1a7707);}router['post'](a2_0x48b673(0x111),async(_0x541584,_0x5d79ce)=>{const _0x257907=a2_0x48b673;try{const {username:_0x3f5c20,password:_0x572361}=_0x541584[_0x257907(0x108)],_0x280929=await a2_0x3af5d8[_0x257907(0x11c)]({'username':_0x3f5c20});if(_0x280929)return _0x5d79ce[_0x257907(0x10d)](0x190)[_0x257907(0x11a)]({'message':_0x257907(0x115)});const _0xbd63b0=await a2_0x12a5e7[_0x257907(0x114)](_0x572361,0xa),_0x3c9bb7=new a2_0x3af5d8({'username':_0x3f5c20,'password':_0xbd63b0});await _0x3c9bb7[_0x257907(0x11e)](),await addLog(_0x257907(0x106),_0x257907(0x112)+_0x3f5c20,_0x3f5c20,{'userId':_0x3c9bb7[_0x257907(0x11d)]}),_0x5d79ce[_0x257907(0x11a)]({'message':_0x257907(0x117)});}catch(_0x253fbe){console[_0x257907(0x10c)]('[Register\x20Error]',_0x253fbe),_0x5d79ce[_0x257907(0x10d)](0x1f4)[_0x257907(0x11a)]({'message':_0x257907(0x102)});}}),router['post']('/login',async(_0x274978,_0x368a0b)=>{const _0x417a83=a2_0x48b673;try{const {username:_0x73c07f,password:_0x4b0af0}=_0x274978['body'],_0x513e49=await a2_0x3af5d8[_0x417a83(0x11c)]({'username':_0x73c07f});if(!_0x513e49)return await addLog(_0x417a83(0x10e),'Login\x20attempt\x20for\x20non-existent\x20user:\x20'+_0x73c07f),_0x368a0b['status'](0x191)[_0x417a83(0x11a)]({'message':_0x417a83(0x10f)});const _0x26c84b=await a2_0x12a5e7[_0x417a83(0x110)](_0x4b0af0,_0x513e49[_0x417a83(0x103)]);if(!_0x26c84b)return await addLog(_0x417a83(0x10e),_0x417a83(0x10a)+_0x73c07f,_0x73c07f),_0x368a0b[_0x417a83(0x10d)](0x191)[_0x417a83(0x11a)]({'message':'Invalid\x20credentials'});const _0x55255a=a2_0x49ad9b[_0x417a83(0x119)]({'username':_0x513e49[_0x417a83(0x122)]},JWT_SECRET,{'expiresIn':'1h'});await addLog('USER_LOGIN','User\x20logged\x20in\x20successfully:\x20'+_0x73c07f,_0x73c07f,{'loginTime':new Date(),'ip':_0x274978['ip']}),_0x368a0b[_0x417a83(0x11a)]({'token':_0x55255a});}catch(_0x5de6be){console[_0x417a83(0x10c)]('[Login\x20Error]',_0x5de6be),_0x368a0b['status'](0x1f4)['json']({'message':_0x417a83(0x102)});}});export default router;